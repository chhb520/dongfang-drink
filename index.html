
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>ä¸œæ–¹æ ‘å¶ä¸‰å¾—åˆ©ä»·æ ¼è®¡ç®—å™¨</title>
  <style>
    :root{
      --bg:#fdfdfd;--card:#ffffff;--muted:#555;--text:#111;--accent:#007bff;--ok:#26c281;--warn:#ff6b6b;
      --border-light:rgba(0,0,0,.06);--border-dark:rgba(255,255,255,.06);
      --shadow-light:rgba(0,0,0,.1);--shadow-dark:rgba(0,0,0,.35);
      --font-family: "PingFang SC","Hiragino Sans GB","Microsoft YaHei","SimSun",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
    }
    [data-theme="dark"]{
      --bg:#0b1020;--card:#121a33;--muted:#93a0b2;--text:#eaf1ff;--accent:#4da3ff;--ok:#26c281;--warn:#ff5c5c;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 var(--font-family);transition:.3s background,.3s color;-webkit-text-size-adjust:100%;touch-action:manipulation}
    .wrap{max-width:980px;margin:32px auto;padding:0 16px}
    h1{font-size:clamp(18px,5vw,25px);letter-spacing:.5px;margin:0 0 10px;line-height:1.2}
    .sub{color:var(--muted);margin-bottom:20px;font-size:14px;line-height:1.5}
    .card{background:var(--card);border:1px solid var(--border-light);border-radius:18px;box-shadow:0 10px 30px var(--shadow-light);overflow:hidden;transition:.3s all}
    [data-theme="dark"] .card{border:1px solid var(--border-dark);box-shadow:0 10px 30px var(--shadow-dark)}
    .row{display:grid;grid-template-columns:120px 1fr 1fr 1fr 1fr 1fr;gap:8px;align-items:center;min-height:60px}
    .head{padding:12px 16px;background:rgba(0,0,0,.03);position:sticky;top:0;backdrop-filter:blur(8px);z-index:10}
    [data-theme="dark"] .head{background:rgba(255,255,255,.03)}
    .body{padding:8px 16px;display:grid;gap:6px}
    .row>div,.row>label{padding:8px 6px;font-size:14px}
    .row.head>div{font-weight:600;color:var(--accent);font-size:13px}
    .size{font-weight:600;font-size:14px;line-height:1.2}
    .field{display:flex;gap:4px;align-items:center;justify-content:center}
    
    /* è¾“å…¥æ¡†èƒŒæ™¯å’Œè¾¹æ¡†å¢å¼ºæ ·å¼ */
    .input-field {
      position: relative;
      background: linear-gradient(135deg, rgba(0,123,255,0.08), rgba(0,123,255,0.04));
      border: 2px solid rgba(0,123,255,0.2);
      border-radius: 10px;
      padding: 1px;
      transition: all 0.3s ease;
      max-width: 85px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    [data-theme="dark"] .input-field {
      background: linear-gradient(135deg, rgba(77,163,255,0.12), rgba(77,163,255,0.06));
      border: 2px solid rgba(77,163,255,0.3);
    }
    
    .input-field:hover {
      border-color: rgba(0,123,255,0.4);
      background: linear-gradient(135deg, rgba(0,123,255,0.12), rgba(0,123,255,0.06));
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,123,255,0.15);
    }
    
    [data-theme="dark"] .input-field:hover {
      border-color: rgba(77,163,255,0.5);
      background: linear-gradient(135deg, rgba(77,163,255,0.18), rgba(77,163,255,0.08));
      box-shadow: 0 4px 12px rgba(77,163,255,0.2);
    }
    
    .input-field.focused {
      border-color: var(--accent);
      background: linear-gradient(135deg, rgba(0,123,255,0.15), rgba(0,123,255,0.08));
      box-shadow: 0 0 0 3px rgba(0,123,255,0.1), 0 6px 16px rgba(0,123,255,0.2);
      transform: translateY(-2px);
    }
    
    [data-theme="dark"] .input-field.focused {
      background: linear-gradient(135deg, rgba(77,163,255,0.2), rgba(77,163,255,0.1));
      box-shadow: 0 0 0 3px rgba(77,163,255,0.15), 0 6px 16px rgba(77,163,255,0.25);
    }
    
    input[type="number"]{width:100%;padding:8px 6px;border-radius:8px;border:none;background:transparent;color:var(--text);transition:.2s all;font-size:14px;-webkit-appearance:none;appearance:none;font-weight:500;text-align:center;font-family:var(--font-family)}
    input[type="number"]:focus{outline:none}
    input[type="number"]:invalid{color:var(--warn)}
    [data-theme="dark"] input[type="number"]{color:var(--text)}
    
    /* ç¡®ä¿æ‰€æœ‰åˆ—çš„å†…å®¹éƒ½å±…ä¸­å¯¹é½ */
    .row > div:nth-child(2),  /* æ€»ä»·åˆ— */
    .row > div:nth-child(3),  /* ç“¶æ•°åˆ— */
    .row > div:nth-child(4),  /* æ¯ç“¶åˆ— */
    .row > div:nth-child(5),  /* æ¯æ¯«å‡åˆ— */
    .row > div:nth-child(6) { /* æ¯å‡åˆ— */
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    /* ä¿®å¤ä¸‹æ‹‰èœå•æ ·å¼ - å…³é”®ä¿®å¤éƒ¨åˆ† */
    select{width:100%;padding:10px 8px;border-radius:10px;border:2px solid var(--border-light);background:#fff;color:var(--text);transition:.2s all;font-size:14px;-webkit-appearance:none;appearance:none;text-align:left;font-family:var(--font-family)}
    select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(77,163,255,.2)}
    
    /* é»‘è‰²ä¸»é¢˜ä¸‹çš„selectæ ·å¼ */
    [data-theme="dark"] select{background:#0e152b;border:2px solid var(--border-dark);color:var(--text)}
    
    /* ä¿®å¤ä¸‹æ‹‰èœå•é€‰é¡¹åœ¨é»‘è‰²ä¸»é¢˜ä¸‹çš„æ˜¾ç¤ºé—®é¢˜ */
    select option {
      background: #fff;
      color: #333;
      padding: 8px;
    }
    
    [data-theme="dark"] select option {
      background: #0e152b;
      color: #eaf1ff;
      padding: 8px;
    }
    
    /* é’ˆå¯¹ä¸åŒæµè§ˆå™¨çš„å…¼å®¹æ€§ä¿®å¤ */
    [data-theme="dark"] select option:checked {
      background: #121a33;
      color: #eaf1ff;
    }
    
    [data-theme="dark"] select option:hover {
      background: #1a2744;
      color: #eaf1ff;
    }
    
    /* è´§å¸ç¬¦å·ç‰¹æ®Šå¤„ç† */
    .currency-symbol {
      font-family: "SimSun", "å®‹ä½“", "Microsoft YaHei", serif;
      font-weight: normal;
    }
    
    .unit{opacity:.7;font-size:11px;white-space:nowrap}
    .muted{color:var(--muted)}
    
    /* ç»Ÿä¸€çš„æ§åˆ¶æ å¸ƒå±€ */
    .controls{margin:16px 0}
    .controls-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:center;
      align-items:center;
    }
    
    /* è´§å¸é€‰æ‹©å™¨æ ·å¼ */
    .currency-selector{
      display:inline-flex;
      gap:6px;
      align-items:center;
      padding:8px 12px;
      border-radius:10px;
      background:rgba(0,0,0,.06);
      border:2px solid var(--border-light);
      font-size:14px;
      min-height:44px;
      flex-shrink:0;
    }
    [data-theme="dark"] .currency-selector{background:rgba(255,255,255,.06);border:2px solid var(--border-dark)}
    
    .currency-selector select{
      padding:4px 6px;
      font-size:14px;
      min-height:auto;
      border:none;
      background:transparent;
      width:auto;
      min-width:80px;
    }
    
    /* è´§å¸é€‰æ‹©å™¨å†…selectçš„ç‰¹æ®Šå¤„ç† */
    .currency-selector select option {
      background: #fff;
      color: #333;
    }
    
    [data-theme="dark"] .currency-selector select option {
      background: #0e152b;
      color: #eaf1ff;
    }
    
    button{cursor:pointer;border:2px solid var(--border-light);background:#fff;color:var(--text);padding:10px 14px;border-radius:10px;transition:.2s all;font-size:14px;min-height:44px;touch-action:manipulation;-webkit-tap-highlight-color:transparent;font-family:var(--font-family);white-space:nowrap;flex-shrink:0}
    button:hover,button:active{border-color:var(--accent);background:rgba(0,123,255,.05);transform:translateY(0)}
    [data-theme="dark"] button{background:#0e152b;border:2px solid var(--border-dark);color:var(--text)}
    [data-theme="dark"] button:hover,[data-theme="dark"] button:active{background:rgba(77,163,255,.1)}
    
    /* ç‰¹æ®ŠæŒ‰é’®æ ·å¼ */
    .add-custom{background:var(--ok);color:#fff;border:2px solid var(--ok)}
    .add-custom:hover{background:rgba(38,194,129,.9);border-color:var(--ok)}
    
    .footer{display:flex;flex-direction:column;gap:12px;padding:14px 16px;color:var(--muted);border-top:1px dashed var(--border-light)}
    [data-theme="dark"] .footer{border-top:1px dashed var(--border-dark)}
    .footer-formula{font-size:12px;text-align:center}
    .kpi{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .highlight-card{
      padding:10px 14px;
      border-radius:12px;
      font-weight:700;
      font-size:13px;
      box-shadow:0 3px 8px rgba(0,0,0,.15);
      transition:.2s transform;
      text-align:center;
      flex:1;
      min-width:120px;
    }
    .highlight-card:active{transform:scale(0.98)}
    .highlight-best{background:var(--ok);color:#fff;}
    .highlight-worst{background:var(--warn);color:#fff;}
    .summary{margin-top:24px;padding:16px;border-radius:16px;background:rgba(0,0,0,.05);border:1px dashed var(--border-light);font-size:14px}
    [data-theme="dark"] .summary{background:rgba(255,255,255,.05);border:1px dashed var(--border-dark)}
    .summary h3{margin:0 0 12px;font-size:16px}
    a{color:var(--accent);text-decoration:none}
    .toast{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-100%);background:var(--card);border:2px solid var(--border-light);border-radius:12px;padding:12px 16px;box-shadow:0 4px 12px var(--shadow-light);z-index:1000;transition:.3s transform;max-width:90vw;text-align:center;font-family:var(--font-family)}
    .toast.show{transform:translateX(-50%) translateY(0)}
    [data-theme="dark"] .toast{border:2px solid var(--border-dark);box-shadow:0 4px 12px var(--shadow-dark)}
    .custom-row{border:2px dashed var(--accent);border-radius:12px;padding:8px;margin:4px 0}
    .remove-btn{background:var(--warn);color:#fff;border:none;padding:8px 12px;border-radius:8px;font-size:12px;margin-left:4px;min-height:40px;touch-action:manipulation;font-family:var(--font-family)}
    
    /* æ‰‹æœºä¸“ç”¨ä¼˜åŒ– */
    @media (max-width: 800px){
      .wrap{margin:16px auto;padding:0 12px}
      h1{font-size:20px;margin-bottom:8px}
      .sub{font-size:13px;margin-bottom:16px}
      .row{grid-template-columns:90px 1fr 1fr 1fr 1fr;gap:6px;min-height:50px}
      .perL{display:none!important}
      .head{padding:10px 12px}
      .body{padding:6px 12px}
      .row>div,.row>label{padding:6px 4px;font-size:13px}
      .row.head>div{font-size:12px}
      .size{font-size:11px}
      
      .input-field {
        max-width: 70px;
        padding: 1px;
        border-radius: 8px;
      }
      
      input[type="number"]{padding:8px 4px;font-size:14px;border-radius:6px}
      
      .unit{font-size:10px}
      .controls{margin:12px 0}
      
      /* ç§»åŠ¨ç«¯æ§åˆ¶æŒ‰é’®å¸ƒå±€ */
      .controls-row{
        flex-direction:column;
        align-items:stretch;
        gap:8px;
      }
      
      .controls-row > *{
        width:100%;
        justify-content:center;
        text-align:center;
      }
      
      .currency-selector{
        justify-content:center;
        text-align:center;
        padding:10px 12px;
      }
      
      .currency-selector select{
        text-align:center;
        width:100%;
      }
      
      button{padding:12px;font-size:13px;border-radius:8px}
      .kpi{gap:6px}
      .highlight-card{padding:8px 10px;font-size:12px;min-width:100px}
      .footer{padding:12px}
      .footer-formula{font-size:11px}
      .summary{padding:12px;font-size:13px;margin-top:16px}
      .summary h3{font-size:15px;margin-bottom:8px}
      .toast{top:10px;left:10px;right:10px;transform:translateY(-100%);max-width:none}
      .toast.show{transform:translateY(0)}
    }
    
    @media (max-width: 500px){
      .wrap{padding:0 8px}
      .row{grid-template-columns:80px 1fr 1fr 1fr 1fr;gap:4px}
      .row>div,.row>label{padding:4px 2px;font-size:12px}
      .size{font-size:10px}
      
      .input-field {
        max-width: 60px;
      }
      
      input[type="number"]{padding:6px 3px;font-size:14px}
      .controls-row{gap:6px}
      button{padding:10px 8px;font-size:12px;min-height:40px}
      .remove-btn{padding:6px 8px;min-height:36px}
      .highlight-card{padding:6px 8px;font-size:11px;min-width:80px}
      .kpi{gap:4px}
      
      .currency-selector{
        padding:8px 10px;
        min-height:40px;
      }
      
      .currency-selector select{
        font-size:12px;
      }
    }
    
    /* ä¸­ç­‰å±å¹•ä¼˜åŒ– */
    @media (max-width: 1000px) and (min-width: 801px){
      .controls-row{
        gap:6px;
      }
      
      button{
        padding:8px 12px;
        font-size:13px;
      }
      
      .currency-selector{
        padding:6px 10px;
      }
      
      .currency-selector select{
        font-size:13px;
        min-width:70px;
      }
    }
    
    /* æ¨ªå±ä¼˜åŒ– */
    @media (max-width: 800px) and (orientation: landscape){
      .wrap{margin:8px auto}
      h1{font-size:18px;margin-bottom:6px}
      .sub{margin-bottom:12px}
      .controls{margin:8px 0}
      .controls-row{flex-direction:row;flex-wrap:wrap;justify-content:center}
      .controls-row > *{width:auto;flex:0 0 auto}
      .summary{margin-top:12px}
    }
    
    /* å‡å°‘åŠ¨ç”»ï¼ˆèŠ‚çœç”µé‡ï¼‰ */
    @media (prefers-reduced-motion: reduce){
      *{transition:none!important;animation:none!important}
    }
    
    /* é«˜å¯¹æ¯”åº¦æ”¯æŒ */
    @media (prefers-contrast: high){
      input[type="number"],select,button{border-width:3px}
    }
    
    /* è§¦æ‘¸ç›®æ ‡ä¼˜åŒ– */
    input,button,select{min-height:44px}
    @media (pointer: coarse){
      input,button,select{min-height:48px}
    }
    
    /* é˜²æ­¢ç¼©æ”¾æ—¶å¸ƒå±€é”™ä¹± */
    .row{overflow-x:auto}
    
    /* iOS Safari ä¼˜åŒ– */
    input[type="number"]{-webkit-appearance:none;-moz-appearance:textfield}
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
    
    /* é”®ç›˜å¼¹å‡ºæ—¶çš„ä¼˜åŒ– */
    @media (max-height: 500px){
      .summary{display:none}
      .footer-formula{display:none}
    }
  </style>
</head>
<body data-theme="light">
  <div class="wrap">
    <h1>ä¸œæ–¹æ ‘å¶ä¸‰å¾—åˆ©ä»·æ ¼è®¡ç®—å™¨</h1>
   <div class="tools-container">

    <div class="calc-box">
        <div class="calc-title">ğŸ§® ç®€æ˜“è®¡ç®—å™¨</div>
        <div class="calc-row">
            <input type="text" id="calcInput" placeholder="å¦‚ï¼š18*6-3+2.5">
            <div class="calc-actions">
                <button class="calc-btn calc-clear" onclick="clearCalc()">æ¸…ç©º</button>
                <button class="calc-btn calc-run" onclick="runCalc()">è®¡ç®—</button>
            </div>
        </div>
        <div class="calc-output" id="calcResult">ç­‰å¾…è¾“å…¥...</div>
    </div>

    <div class="tool-divider"></div>

    <div class="rmb-box">
        <div class="rmb-title">ğŸ’° äººæ°‘å¸å¤§å†™è½¬æ¢</div>
        <div class="rmb-row">
            <input type="number" id="rmbNumInput" placeholder="è¾“å…¥é‡‘é¢" step="any">
            <div class="rmb-actions">
                <button class="rmb-btn rmb-clear" onclick="clearRmbField()">æ¸…ç©º</button>
                <button class="rmb-btn rmb-copy" onclick="copyRmbResult()">å¤åˆ¶</button>
            </div>
        </div>
        <div class="rmb-output" id="rmbChineseResult">ç­‰å¾…è¾“å…¥...</div>
    </div>

</div>

<style>
    /* é¢œè‰²é…ç½®ä¸­å¿ƒ */
    :root {
        --bg-box: #f5f5f5;        /* æ¨¡å—èƒŒæ™¯ï¼šæµ…ç°è‰² */
        --bg-input: #ffffff;      /* è¾“å…¥æ¡†èƒŒæ™¯ï¼šçº¯ç™½ï¼ˆå½¢æˆå¯¹æ¯”ï¼Œæ–¹ä¾¿çœ‹æ¸…ï¼‰ */
        --text-main: #333333;     /* ä¸»æ–‡å­—é¢œè‰² */
        --border-color: #dcdcdc;  /* è¾¹æ¡†é¢œè‰²ï¼šç•¥æ·±äºèƒŒæ™¯ */
        --shadow: none;           /* ç°è‰²æ¨¡å¼ä¸‹å…³é—­é˜´å½±ï¼Œæ›´ç®€çº¦ */
        
        --calc-theme: #722ed1;
        --calc-out-bg: #efdbff;   /* è®¡ç®—å™¨ç»“æœèƒŒæ™¯ */
        --rmb-theme: #007bff;
        --rmb-out-bg: #e6f7ff;    /* äººæ°‘å¸ç»“æœèƒŒæ™¯ */
        --rmb-out-text: #096dd9;
    }

    /* è‡ªåŠ¨é€‚é…é»‘å¤œæ¨¡å¼ */
    @media (prefers-color-scheme: dark) {
        :root {
            --bg-box: #1e1e1e;     /* é»‘å¤œæ¨¡å¼åº•è‰² */
            --bg-input: #2d2d2d;   /* é»‘å¤œæ¨¡å¼è¾“å…¥æ¡† */
            --text-main: #efefef;
            --border-color: #444444;
            --calc-out-bg: #221633;
            --rmb-out-bg: #112133;
        }
    }

    .tools-container {
        display: flex;
        flex-direction: column;
        max-width: 420px;
    }

    /* é€šç”¨ç›’å­æ ·å¼ */
    .calc-box, .rmb-box {
        padding: 20px;
        background: var(--bg-box);
        color: var(--text-main);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        font-family: -apple-system, sans-serif;
        transition: all 0.3s ease;
    }

    /* åˆ†å‰²çº¿ */
    .tool-divider {
        height: 1px;
        margin: 24px 10px;
        background: var(--border-color);
        position: relative;
    }
    .tool-divider::after {
        content: "TOOL BOX";
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        background: var(--bg-box);
        padding: 0 12px;
        font-size: 10px;
        color: #999;
        letter-spacing: 2px;
    }

    .calc-title { font-size: 14px; font-weight: bold; color: var(--calc-theme); margin-bottom: 12px; }
    .rmb-title { font-size: 14px; font-weight: bold; color: var(--rmb-theme); margin-bottom: 12px; }

    .calc-row, .rmb-row { display: flex; gap: 8px; align-items: center; }

    #calcInput, #rmbNumInput {
        width: 150px;
        padding: 10px 12px;
        background: var(--bg-input);
        color: var(--text-main);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        outline: none;
        font-size: 14px;
    }

    #calcInput:focus { border-color: var(--calc-theme); }
    #rmbNumInput:focus { border-color: var(--rmb-theme); }

    .calc-actions, .rmb-actions { display: flex; gap: 6px; }

    .calc-btn, .rmb-btn {
        padding: 9px 14px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        white-space: nowrap;
        transition: transform 0.1s;
    }
    .calc-btn:active, .rmb-btn:active { transform: scale(0.95); }

    .calc-run { background: var(--calc-theme); color: white; }
    .rmb-copy { background: var(--rmb-theme); color: white; }
    .calc-clear, .rmb-clear { background: #fff; color: #ff4d4f; border: 1px solid #ff4d4f; }
    /* é»‘å¤œæ¨¡å¼ä¸‹å¾®è°ƒæ¸…é™¤æŒ‰é’® */
    @media (prefers-color-scheme: dark) { .calc-clear, .rmb-clear { background: transparent; } }

    .calc-output, .rmb-output {
        margin-top: 15px;
        padding: 12px;
        border-radius: 8px;
        font-size: 15px;
        font-weight: bold;
        min-height: 44px;
        display: flex;
        align-items: center;
        word-break: break-all;
    }

    .calc-output { background: var(--calc-out-bg); border-left: 4px solid var(--calc-theme); color: var(--calc-theme); }
    .rmb-output { background: var(--rmb-out-bg); border-left: 4px solid var(--rmb-out-text); color: var(--rmb-out-text); }
</style>

<script>
/* --- è®¡ç®—å™¨é€»è¾‘ --- */
function calculateExpression(expr){
    if(!/^[\d+\-*/.\s]+$/.test(expr)) return 'ç­‰å¾…æ­£ç¡®è¾“å…¥...';
    try {
        expr = expr.replace(/\s+/g,'');
        if(expr.startsWith('-')) expr = '0' + expr;
        const tokens = expr.match(/(\d+(\.\d+)?)|[+\-*/]/g);
        if(!tokens) return 'ç­‰å¾…è¾“å…¥...';
        let stack = [];
        let i = 0;
        while(i < tokens.length){
            let t = tokens[i];
            if(t === '*' || t === '/'){
                let prev = stack.pop();
                let next = Number(tokens[++i]);
                stack.push(t === '*' ? prev * next : prev / next);
            }else{
                stack.push(isNaN(t) ? t : Number(t));
            }
            i++;
        }
        let result = stack[0];
        for(let j = 1; j < stack.length; j += 2){
            let op = stack[j];
            let num = stack[j + 1];
            if(op === '+') result += num;
            if(op === '-') result -= num;
        }
        return Number(result.toFixed(10)).toString();
    } catch(e) { return "é”™è¯¯"; }
}

const cInput = document.getElementById('calcInput');
const cRes = document.getElementById('calcResult');
cInput.addEventListener('input',()=>{
    const val = cInput.value.trim();
    cRes.innerText = val ? calculateExpression(val) : 'ç­‰å¾…è¾“å…¥...';
});
function runCalc(){ cRes.innerText = calculateExpression(cInput.value); }
function clearCalc(){ cInput.value = ''; cRes.innerText = 'ç­‰å¾…è¾“å…¥...'; cInput.focus(); }

/* --- äººæ°‘å¸å¤§å†™é€»è¾‘ --- */
function digitToChinese(n) {
    if (!n || isNaN(n)) return "ç­‰å¾…è¾“å…¥...";
    if (n >= 9999999999999.99) return "é‡‘é¢è¿‡å¤§";
    let unit = "ä»Ÿä½°æ‹¾äº¿ä»Ÿä½°æ‹¾ä¸‡ä»Ÿä½°æ‹¾å…ƒè§’åˆ†", str = "";
    n = parseFloat(n).toFixed(2);
    let p = n.indexOf('.');
    if (p >= 0) n = n.substring(0, p) + n.substr(p + 1, 2);
    unit = unit.substr(unit.length - n.length);
    for (let i = 0; i < n.length; i++) {
        str += 'é›¶å£¹è´°åè‚†ä¼é™†æŸ’æŒç–'.charAt(n.charAt(i)) + unit.charAt(i);
    }
    let res = str.replace(/é›¶(ä»Ÿ|ä½°|æ‹¾|è§’)/g, "é›¶").replace(/(é›¶)+/g, "é›¶").replace(/é›¶(ä¸‡|äº¿|å…ƒ)/g, "$1").replace(/(äº¿)ä¸‡/g, "$1").replace(/^å…ƒé›¶?|é›¶åˆ†/g, "").replace(/å…ƒ$/g, "å…ƒæ•´");
    return res || "é›¶å…ƒæ•´";
}

const rInput = document.getElementById('rmbNumInput');
const rRes = document.getElementById('rmbChineseResult');
rInput.addEventListener('input', (e) => { rRes.innerText = digitToChinese(e.target.value); });
function clearRmbField() { rInput.value = ""; rRes.innerText = "ç­‰å¾…è¾“å…¥..."; rInput.focus(); }
function copyRmbResult() {
    const text = rRes.innerText;
    if (text && text !== "ç­‰å¾…è¾“å…¥..." && !text.includes('å¤§')) {
        navigator.clipboard.writeText(text).then(() => {
            const btn = document.querySelector('.rmb-copy');
            btn.innerText = 'å·²å¤åˆ¶';
            setTimeout(() => btn.innerText = 'å¤åˆ¶', 1500);
        });
    }
}


</script>
    <div class="sub">è¾“å…¥æ€»ä»·ä¸ç“¶æ•°ï¼Œè‡ªåŠ¨è®¡ç®—å•ä»·å¹¶æ ‡è®°æœ€åˆ’ç®—å®¹é‡ã€‚å»ºè®®æ¯å‡<strong>â‰¤5.5å…ƒ</strong>å¯å†²ã€‚</div>

    <div class="controls">
      <div class="controls-row">
        <button id="addCustom" class="add-custom">â• è‡ªå®šä¹‰å®¹é‡</button>
        <button id="demo">ğŸ“ ç¤ºä¾‹</button>
        <button id="reset">ğŸ—‘ï¸ æ¸…ç©º</button>
        <button id="export">ğŸ“¤ å¯¼å‡º</button>
        <button id="import">ğŸ“¥ å¯¼å…¥</button>
        <button id="toggleTheme">ğŸŒ™ ä¸»é¢˜</button>
        <div class="currency-selector">ğŸ’° 
          <select id="currency">
            <option value="Â¥"><span class="currency-symbol">Â¥</span> äººæ°‘å¸</option>
            <option value="$">$ ç¾å…ƒ</option>
            <option value="â‚¬">â‚¬ æ¬§å…ƒ</option>
            <option value="Â£">Â£ è‹±é•‘</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card" role="table" aria-label="ä»·æ ¼è®¡ç®—è¡¨">
      <div class="row head" role="row">
        <div class="size" role="columnheader">å®¹é‡è§„æ ¼</div>
        <div role="columnheader">æ€»ä»·</div>
        <div role="columnheader">ç“¶æ•°</div>
        <div role="columnheader">æ¯ç“¶</div>
        <div role="columnheader">æ¯æ¯«å‡</div>
        <div class="perL" role="columnheader">æ¯å‡</div>
      </div>
      <div class="body" id="rows"></div>
      <div class="footer">
        <div class="footer-formula">å…¬å¼ï¼šæ¯æ¯«å‡å•ä»· = æ€»ä»· Ã· (ç“¶æ•° Ã— å®¹é‡ml)ï¼Œæ¯ç“¶ä»·æ ¼ = æ€»ä»· Ã· ç“¶æ•°</div>
        <div class="kpi">
          <span id="bestBadge" class="highlight-card highlight-best">æœ€åˆ’ç®—ï¼š--</span>
          <span id="worstBadge" class="highlight-card highlight-worst">æœ€è´µï¼š--</span>
        </div>
      </div>
    </div>

    <div class="summary" id="summaryBox">
      <h3>ğŸ“Š è´­ç‰©æ€»è®¡</h3>
      <div id="summaryResult">è¯·å¡«å†™æ•°æ®ä»¥æŸ¥çœ‹æ€»è®¡ç»“æœã€‚</div>
    </div>

    <p class="muted" style="margin-top:12px;font-size:12px;text-align:center">ğŸ’¡ æ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°ï¼Œä»…æ¯”è¾ƒå•ä½æ¯«å‡ä»·æ ¼</p>
  </div>

  <input type="file" id="fileInput" accept=".json" style="display:none">

<script>
class PriceCalculator {
  constructor() {
    this.sizes = [
      {name:'ä¸œæ–¹æ ‘å¶335ml', size:335},
      {name:'ä¸œæ–¹æ ‘å¶500ml', size:500},
      {name:'ä¸‰å¾—åˆ©500ml', size:500},
      {name:'ä¸œæ–¹æ ‘å¶900ml', size:900},
      {name:'ä¸‰å¾—åˆ©1250ml', size:1250},
      {name:'ä¸œæ–¹æ ‘å¶1500ml', size:1500},
    ];
    
    this.state = new Map();
    this.customCounter = 0;
    this.debounceTimer = null;
    this.isMobile = window.innerWidth <= 800;
    
    this.elements = {
      rows: document.getElementById('rows'),
      currency: document.getElementById('currency'),
      bestBadge: document.getElementById('bestBadge'),
      worstBadge: document.getElementById('worstBadge'),
      summaryResult: document.getElementById('summaryResult'),
      fileInput: document.getElementById('fileInput')
    };
    
    this.init();
  }

  init() {
    this.createInitialRows();
    this.bindEvents();
    this.loadTheme();
    this.loadData();
    this.compute();
    this.handleResize();
  }

  handleResize() {
    window.addEventListener('resize', () => {
      this.isMobile = window.innerWidth <= 800;
    });
    
    // å¤„ç†é”®ç›˜å¼¹å‡º
    let initialHeight = window.innerHeight;
    window.addEventListener('resize', () => {
      if (this.isMobile && window.innerHeight < initialHeight * 0.75) {
        document.body.classList.add('keyboard-open');
      } else {
        document.body.classList.remove('keyboard-open');
      }
    });
  }

  createInitialRows() {
    this.sizes.forEach(item => this.createRow(item));
  }

  createRow(item, isCustom = false) {
    const row = document.createElement('div');
    row.className = `row ${isCustom ? 'custom-row' : ''}`;
    row.setAttribute('data-size', isCustom ? 'custom' : item.size);

    const c0 = document.createElement('div');
    if (isCustom) {
      c0.innerHTML = `
        <div style="display:flex;align-items:center;gap:2px;flex-wrap:wrap">
          <input type="number" min="1" step="1" placeholder="ml" style="width:50px;flex:1;min-width:40px" title="è¾“å…¥å®¹é‡(æ¯«å‡)" inputmode="numeric">
          <button class="remove-btn" title="åˆ é™¤æ­¤è¡Œ">Ã—</button>
        </div>
      `;
    } else {
      const displayName = this.isMobile ? item.name.replace('ä¸œæ–¹æ ‘å¶', 'ä¸œæ–¹').replace('ä¸‰å¾—åˆ©', 'ä¸‰å¾—') : item.name;
      c0.innerHTML = `<span class="size" title="${item.name}">${displayName}</span>`;
    }

    const priceWrap = this.createInputField('decimal', '12.90', 'æ€»ä»·');
    const countWrap = this.createInputField('numeric', '6', 'ç“¶æ•°');

    const perBottle = document.createElement('div');
    const perMl = document.createElement('div');
    const perL = document.createElement('div'); 
    perL.className = 'perL';

    row.append(c0, priceWrap, countWrap, perBottle, perMl, perL);
    this.elements.rows.appendChild(row);

    const key = isCustom ? `custom-${++this.customCounter}` : `${item.name}-${item.size}`;
    const stateObj = {
      row,
      sizeInput: isCustom ? c0.querySelector('input[type="number"]') : null,
      size: item.size,
      price: priceWrap.querySelector('input'),
      count:countWrap.querySelector('input'),
      perBottle, perMl, perL
    };
    
    this.state.set(key, stateObj);

    // ç»‘å®šäº‹ä»¶
    stateObj.price.addEventListener('input', () => this.debouncedCompute());
    stateObj.count.addEventListener('input', () => this.debouncedCompute());
    
    // ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šå¤±ç„¦æ—¶è‡ªåŠ¨è®¡ç®—
    if (this.isMobile) {
      stateObj.price.addEventListener('blur', () => this.compute());
      stateObj.count.addEventListener('blur', () => this.compute());
    }
    
    if (isCustom) {
      stateObj.sizeInput.addEventListener('input', () => this.debouncedCompute());
      if (this.isMobile) {
        stateObj.sizeInput.addEventListener('blur', () => this.compute());
      }
      c0.querySelector('.remove-btn').addEventListener('click', () => this.removeCustomRow(key));
    }

    // æ·»åŠ è¾“å…¥éªŒè¯
    this.addInputValidation(stateObj.price);
    this.addInputValidation(stateObj.count);
    if (stateObj.sizeInput) this.addInputValidation(stateObj.sizeInput);

    return key;
  }

  createInputField(inputMode, placeholder, title) {
    const wrap = document.createElement('div');
    wrap.className = 'field input-field';
    const input = document.createElement('input');
    input.type = 'number';
    input.min = '0';
    // ä¿®æ”¹stepè®¾ç½®ï¼Œå…è®¸ä»»æ„å°æ•°ä½æ•°
    input.step = inputMode === 'decimal' ? 'any' : '1';
    input.placeholder = placeholder;
    input.title = title;
    input.setAttribute('inputmode', inputMode);
    
    // ç§»åŠ¨ç«¯é˜²æ­¢ç¼©æ”¾
    if (this.isMobile) {
      input.style.fontSize = '16px';
    }
    
    // æ·»åŠ èšç„¦/å¤±ç„¦äº‹ä»¶ç›‘å¬æ¥åˆ‡æ¢æ ·å¼
    input.addEventListener('focus', () => {
      wrap.classList.add('focused');
    });
    input.addEventListener('blur', () => {
      wrap.classList.remove('focused');
    });
    
    wrap.appendChild(input);
    return wrap;
  }

  addInputValidation(input) {
    input.addEventListener('blur', (e) => {
      const value = parseFloat(e.target.value);
      if (e.target.value && (!isFinite(value) || value < 0)) {
        e.target.classList.add('error');
        this.showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„æ­£æ•°', 'error');
      } else {
        e.target.classList.remove('error');
        if (e.target.value) e.target.classList.add('success');
      }
    });

    input.addEventListener('input', (e) => {
      e.target.classList.remove('error', 'success');
    });
    
    // ç§»åŠ¨ç«¯ï¼šæ•°å­—é”®ç›˜ä¼˜åŒ–
    if (this.isMobile) {
      input.addEventListener('focus', (e) => {
        // æ»šåŠ¨åˆ°å¯è§åŒºåŸŸ
        setTimeout(() => {
          e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 300);
      });
    }
  }

  removeCustomRow(key) {
    const stateObj = this.state.get(key);
    if (stateObj && stateObj.row) {
      stateObj.row.remove();
      this.state.delete(key);
      this.debouncedCompute();
      this.saveData();
      this.showToast('å·²åˆ é™¤è‡ªå®šä¹‰è¡Œ', 'success');
    }
  }

  bindEvents() {
    document.getElementById('addCustom').addEventListener('click', () => {
      this.createRow({name:'è‡ªå®šä¹‰', size:0}, true);
      this.saveData();
      this.showToast('å·²æ·»åŠ è‡ªå®šä¹‰è¡Œ', 'success');
    });

    document.getElementById('reset').addEventListener('click', () => {
      this.resetAll();
    });

    document.getElementById('demo').addEventListener('click', () => this.loadDemo());
    document.getElementById('export').addEventListener('click', () => this.exportData());
    document.getElementById('import').addEventListener('click', () => this.elements.fileInput.click());
    document.getElementById('toggleTheme').addEventListener('click', () => this.toggleTheme());

    this.elements.currency.addEventListener('change', () => {
      this.compute();
      this.saveData();
    });

    this.elements.fileInput.addEventListener('change', (e) => this.importData(e));

    // ç§»åŠ¨ç«¯ï¼šç®€åŒ–é”®ç›˜å¿«æ·é”®
    if (!this.isMobile) {
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case 'r': e.preventDefault(); this.resetAll(); break;
            case 'd': e.preventDefault(); this.loadDemo(); break;
            case 's': e.preventDefault(); this.exportData(); break;
          }
        }
      });
    }
  }

  debouncedCompute() {
    clearTimeout(this.debounceTimer);
    const delay = this.isMobile ? 500 : 300; // ç§»åŠ¨ç«¯å»¶é•¿é˜²æŠ–æ—¶é—´
    this.debounceTimer = setTimeout(() => {
      this.compute();
      this.saveData();
    }, delay);
  }

  formatMoney(value, precision = 4) {
    if (!isFinite(value)) return '--';
    const currency = this.elements.currency.value;
    return `${currency}${value.toFixed(precision)}`;
  }

  compute() {
    let best = {size: null, value: Infinity, name: ''};
    let worst = {size: null, value: -Infinity, name: ''};
    let totalPrice = 0;
    let totalMl = 0;
    let validEntries = 0;

    for (const [key, obj] of this.state.entries()) {
      const {sizeInput, size, price, count, perBottle, perMl, perL} = obj;
      const currentSize = sizeInput ? parseFloat(sizeInput.value) : size;
      const currentPrice = parseFloat(price.value);
      const currentCount = parseFloat(count.value);
      
      const isValid = isFinite(currentPrice) && isFinite(currentCount) && 
                     currentCount > 0 && isFinite(currentSize) && currentSize > 0;
      
      if (isValid) {
        const unitPrice = currentPrice / (currentCount * currentSize);
        const bottlePrice = currentPrice / currentCount;
        
        perBottle.innerHTML = `${this.formatMoney(bottlePrice, 2)} <span class="unit">/ ç“¶</span>`;
        perMl.innerHTML = `${this.formatMoney(unitPrice)} <span class="unit">/ ml</span>`;
        
        const perLiterPrice = unitPrice * 1000;
        const isGoodDeal = perLiterPrice <= 5.5;
        const dealIcon = isGoodDeal ? 'âœ…' : '';
        
        if (this.isMobile) {
          perL.innerHTML = `${this.formatMoney(perLiterPrice)} <span class="unit">/ L</span> ${dealIcon}`;
        } else {
          perL.innerHTML = `${this.formatMoney(perLiterPrice)} <span class="unit">/ å‡</span> ${dealIcon}`;
        }

        if (unitPrice < best.value) {
          best = {size: currentSize, value: unitPrice, name: this.getSizeName(key)};
        }
        if (unitPrice > worst.value) {
          worst = {size: currentSize, value: unitPrice, name: this.getSizeName(key)};
        }
        
        totalPrice += currentPrice;
        totalMl += currentCount * currentSize;
        validEntries++;
      } else {
        perBottle.textContent = '--';
        perMl.textContent = '--';
        if (!this.isMobile) perL.textContent = '--';
      }
    }

    this.updateBadges(best, worst);
    this.updateSummary(totalPrice, totalMl, validEntries);
  }

  getSizeName(key) {
    if (key.startsWith('custom-')) return 'è‡ªå®šä¹‰';
    const name = key.split('-')[0];
    return this.isMobile ? name.replace('ä¸œæ–¹æ ‘å¶', 'ä¸œæ–¹').replace('ä¸‰å¾—åˆ©', 'ä¸‰å¾—') : name;
  }

  updateBadges(best, worst) {
    this.elements.bestBadge.textContent = best.size ? 
      `æœ€åˆ’ç®—ï¼š${best.name} (${this.formatMoney(best.value)}/ml)` : 'æœ€åˆ’ç®—ï¼š--';
    
    this.elements.worstBadge.textContent = worst.size ? 
      `æœ€è´µï¼š${worst.name} (${this.formatMoney(worst.value)}/ml)` : 'æœ€è´µï¼š--';
  }

  updateSummary(totalPrice, totalMl, validEntries) {
    if (totalPrice > 0 && totalMl > 0) {
      const avgUnitPrice = totalPrice / totalMl;
      const avgPerLiter = avgUnitPrice * 1000;
      const isGoodDeal = avgPerLiter <= 5.5;
      
      if (this.isMobile) {
        this.elements.summaryResult.innerHTML = `
          <div style="margin-bottom:6px">
            <strong>å…± ${validEntries} ç§å•†å“</strong>
          </div>
          <div style="margin-bottom:6px">
            æ€»è®¡ï¼š${this.formatMoney(totalPrice, 2)} | ${(totalMl/1000).toFixed(1)}L
          </div>
          <div>
            å¹³å‡ï¼š${this.formatMoney(avgPerLiter)} / å‡ ${isGoodDeal ? 'âœ… åˆ’ç®—' : 'âš ï¸ åè´µ'}
          </div>
        `;
      } else {
        this.elements.summaryResult.innerHTML = `
          <div style="margin-bottom:8px">
            <strong>æœ¬æ¬¡è´­ç‰©ç»Ÿè®¡ï¼š</strong>å…± ${validEntries} ç§å•†å“
          </div>
          <div style="margin-bottom:8px">
            æ€»é‡‘é¢ï¼š${this.formatMoney(totalPrice, 2)} | æ€»å®¹é‡ï¼š${totalMl.toLocaleString()}ml
          </div>
          <div>
            å¹³å‡å•ä»·ï¼š${this.formatMoney(avgUnitPrice)} / ml | 
            ${this.formatMoney(avgPerLiter)} / å‡ ${isGoodDeal ? 'âœ… åˆ’ç®—' : 'âš ï¸ åè´µ'}
          </div>
        `;
      }
    } else {
      this.elements.summaryResult.textContent = 'è¯·å¡«å†™æ•°æ®ä»¥æŸ¥çœ‹æ€»è®¡ç»“æœã€‚';
    }
  }

  resetAll() {
    // åˆ é™¤æ‰€æœ‰è‡ªå®šä¹‰è¡Œ
  for (const [key, obj] of this.state.entries()) {
      if (key.startsWith('custom-')) {
        obj.row.remove();
        this.state.delete(key);
      }
    }
    
    // æ¸…ç©ºæ‰€æœ‰è¾“å…¥
    for (const {sizeInput, price, count} of this.state.values()) {
      if (sizeInput) sizeInput.value = '';
      price.value = '';
      count.value = '';
      price.classList.remove('error', 'success');
      count.classList.remove('error', 'success');
    }
    
    this.compute();
    this.saveData();
    this.showToast('å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®', 'success');
  }

  loadDemo() {
    const demo = {
      'ä¸œæ–¹æ ‘å¶335ml-335': {price: 51.9, count: 24},
      'ä¸œæ–¹æ ‘å¶500ml-500': {price: 48.0, count: 15},
      'ä¸‰å¾—åˆ©500ml-500': {price: 37.85, count: 15},
      'ä¸œæ–¹æ ‘å¶900ml-900': {price: 57.0, count: 12},
      'ä¸‰å¾—åˆ©1250ml-1250': {price: 23.2, count: 4},
      'ä¸œæ–¹æ ‘å¶1500ml-1500': {price: 50.4, count: 6},
    };

    for (const [key, obj] of this.state.entries()) {
      const {sizeInput, price, count} = obj;
      if (!key.startsWith('custom-')) {
        const demoData = demo[key];
        price.value = demoData?.price ?? '';
        count.value = demoData?.count ?? '';
      }
    }
    
    this.compute();
    this.saveData();
    this.showToast('å·²åŠ è½½ç¤ºä¾‹æ•°æ®', 'success');
  }

  saveData() {
    try {
      const data = {
        currency: this.elements.currency.value,
        entries: {},
        customRows: []
      };

      for (const [key, obj] of this.state.entries()) {
        if (key.startsWith('custom-')) {
          data.customRows.push({
            size: obj.sizeInput ? obj.sizeInput.value : '',
            price: obj.price.value,
            count: obj.count.value
          });
        } else {
          data.entries[key] = {
            price: obj.price.value,
            count: obj.count.value
          };
        }
      }

      localStorage.setItem('priceCalculatorData', JSON.stringify(data));
    } catch (e) {
      console.warn('ä¿å­˜æ•°æ®å¤±è´¥:', e);
    }
  }

  loadData() {
    try {
      const saved = localStorage.getItem('priceCalculatorData');
      if (!saved) return;

      const data = JSON.parse(saved);
      
      if (data.currency) {
        this.elements.currency.value = data.currency;
      }

      if (data.entries) {
        for (const [key, values] of Object.entries(data.entries)) {
          const obj = this.state.get(key);
          if (obj) {
            obj.price.value = values.price || '';
            obj.count.value = values.count || '';
          }
        }
      }

      if (data.customRows) {
        data.customRows.forEach(row => {
          const key = this.createRow({name:'è‡ªå®šä¹‰', size:0}, true);
          const obj = this.state.get(key);
          if (obj) {
            if (obj.sizeInput) obj.sizeInput.value = row.size || '';
            obj.price.value = row.price || '';
            obj.count.value = row.count || '';
          }
        });
      }
    } catch (e) {
      console.warn('åŠ è½½æ•°æ®å¤±è´¥:', e);
    }
  }

  exportData() {
    try {
      const data = {
        timestamp: new Date().toISOString(),
        currency: this.elements.currency.value,
        entries: {},
        customRows: []
      };

      for (const [key, obj] of this.state.entries()) {
        if (key.startsWith('custom-')) {
          data.customRows.push({
            size: obj.sizeInput ? obj.sizeInput.value : '',
            price: obj.price.value,
            count: obj.count.value
          });
        } else {
          data.entries[key] = {
            price: obj.price.value,
            count: obj.count.value
          };
        }
      }

      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ä»·æ ¼è®¡ç®—å™¨æ•°æ®_${new Date().toISOString().slice(0,10)}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      this.showToast('æ•°æ®å·²å¯¼å‡º', 'success');
    } catch (e) {
      this.showToast('å¯¼å‡ºå¤±è´¥', 'error');
    }
  }

  importData(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const data = JSON.parse(e.target.result);
        
        this.resetAll();
        
        if (data.currency) {
          this.elements.currency.value = data.currency;
        }

        if (data.entries) {
          for (const [key, values] of Object.entries(data.entries)) {
            const obj = this.state.get(key);
            if (obj) {
              obj.price.value = values.price || '';
              obj.count.value = values.count || '';
            }
          }
        }

        if (data.customRows) {
          data.customRows.forEach(row => {
            const key = this.createRow({name:'è‡ªå®šä¹‰', size:0}, true);
            const obj = this.state.get(key);
            if (obj) {
              if (obj.sizeInput) obj.sizeInput.value = row.size || '';
              obj.price.value = row.price || '';
              obj.count.value = row.count || '';
            }
          });
        }

        this.compute();
        this.saveData();
        this.showToast('æ•°æ®å¯¼å…¥æˆåŠŸ', 'success');
      } catch (e) {
        this.showToast('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
      }
    };
    reader.readAsText(file);
    event.target.value = '';
  }

  toggleTheme() {
    const body = document.body;
    const currentTheme = body.getAttribute('data-theme');
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    body.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    const icon = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    document.getElementById('toggleTheme').innerHTML = `${icon} ä¸»é¢˜`;
  }

  loadTheme() {
    const saved = localStorage.getItem('theme');
    if (saved && ['light', 'dark'].includes(saved)) {
      document.body.setAttribute('data-theme', saved);
      const icon = saved === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
      document.getElementById('toggleTheme').innerHTML = `${icon} ä¸»é¢˜`;
    }
  }

  showToast(message, type = 'info') {
    const existingToast = document.querySelector('.toast');
    if (existingToast) existingToast.remove();

    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    
    if (type === 'error') toast.style.borderLeftColor = 'var(--warn)';
    else if (type === 'success') toast.style.borderLeftColor = 'var(--ok)';
    else toast.style.borderLeftColor = 'var(--accent)';
    
    document.body.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 10);
    
    // ç§»åŠ¨ç«¯æ˜¾ç¤ºæ—¶é—´ç¨çŸ­
    const hideDelay = this.isMobile ? 2500 : 3000;
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 300);
    }, hideDelay);
  }
}

// åˆå§‹åŒ–åº”ç”¨
document.addEventListener('DOMContentLoaded', () => {
  new PriceCalculator();
});
</script>
</body>
</html>


